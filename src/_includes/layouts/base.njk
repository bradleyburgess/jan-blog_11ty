{% if not description %}
  {% set description = sitemeta.description | normalizeDescription | sanitizeHtmlAttr %}
{% else %}
  {% set description = description | normalizeDescription %}
{% endif %}
{% if sitePage %}
  {% set title = sitePage.title %}
{% endif %}
{% if (permalink == '/') 
  or not title %}
  {% set docTitle = sitemeta.title %}
{% else %}
  {% set docTitle = [title, sitemeta.title] | join(" | ") %}
{% endif %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="{{ description }}"/>
    {% ogmeta docTitle,
    page.url | toAbsoluteUrl,
    description | normalizeDescription %}
    {% if ogImage %}{% ogimage ogImage.src,
      ogImage.alt %}
    {% elif sitemeta.ogImage %}{% ogimage sitemeta.ogImage.src,
      sitemeta.ogImage.alt %}
    {% endif %}
    <title>{{ docTitle }}</title>
    {# Twitter me #}
    <link rel="me" href="https://twitter.com/jmtapir"/>

    {# google fonts #}
    {% if googlefonts %}<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>{% endif %}

    {# inline css #}
    {% if googlefonts or criticalCss %}
      {% set css %}
      {% if googlefonts %}{{ googlefonts | safe }}
      {% endif %}
      {% if criticalCss %}
        {% for item in criticalCss | makeArray %}
          {% include "critical-css/" + item + ".css" %}
        {% endfor %}
      {% endif %}
      {% endset %}
      <style>
        {{css | safe}}
      </style>
    {% endif %}

    {# inline js #}
    {% if criticalJs %}
      {% set js %}
      {% for item in criticalJs | makeArray %}
        {% include "critical-js/" + item + ".js" %}
      {% endfor %}
      {% endset %}
      <script>
        {{ js | jsmin }}
      </script>
    {% endif %}

    {% if hash.css | has('index') %}<link rel="stylesheet" href="/css/index{{ hash.css.index }}.css" media="screen"/>{% endif %}
    {% if hash.js | has('index') %}
      <script src="/js/index{{ hash.js.index }}.js" defer></script>
    {% endif %}
    {% if pageJs %}
      {% for item in pageJs | makeArray %}
        <script src="/js/{{ item }}{{ hash.js[item] }}.js" defer></script>
      {% endfor %}
    {% endif %}
    {% if sitemeta | has('favicon') %}{% favicons sitemeta.favicon %}
    {% endif %}
  </head>
  <body {% if bodyClass %}class="{{ bodyClass }}"{% endif %}>
    {% include "partials/header.njk" %}
    <main id="main-content" {% if templateClass %}class="{{ templateClass }}"{% endif %}>
      {{ content | safe }}
      <hr />
      <nav class="share-buttons">
        <div class="share-buttons__text">Like it? Why not show some love and share it:</div>
        <ul class="share-buttons__list">
          {% for icon in shareIcons %}
            <li class="share-buttons__list-item">
              <a href="{{ icon.url }}" class="share-button {{ icon.name }}" aria-labelledby="share-label-{{ icon.name }}">
                <span id="share-label-{{ icone.name }}" class="sr-only">Share via {{ icon.name | capitalize }}</span>
                {% include "icons/icon-" + icon.name + ".svg" %}</a>
            </li>
          {% endfor %}
        </ul>
      </nav>
    </main>
    {% include "partials/footer.njk" %}
    {% include "partials/fsbackground.njk" %}
  </body>
</html>